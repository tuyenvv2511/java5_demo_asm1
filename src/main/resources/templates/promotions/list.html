<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<body th:replace="~{layout :: layout(content=~{::section})}">
<section th:fragment="content">
    <div class="d-flex mb-3">
        <h3 class="me-auto" th:text="#{promotion.title}">Promotions</h3>
        <a class="btn btn-success" th:href="@{/promotions/create}" th:text="#{promotion.createBtn}">Create Promotion</a>
    </div>

    <!-- Alert messages -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}">Success message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}">Error message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover bg-white shadow-sm">
            <thead>
                <tr>
                    <th th:text="#{promotion.id}">ID</th>
                    <th th:text="#{promotion.product}">Product</th>
                    <th th:text="#{promotion.promotionType}">Promotion Type</th>
                    <th th:text="#{promotion.discountValue}">Discount Value</th>
                    <th th:text="#{promotion.originalPrice}">Original Price</th>
                    <th th:text="#{promotion.priceAfterDiscount}">Price After Discount</th>
                    <th th:text="#{promotion.timePeriod}">Time Period</th>
                    <th th:text="#{promotion.status}">Status</th>
                    <th th:text="#{promotion.actions}">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="promotion : ${promotions}">
                    <td th:text="${promotion.id}">1</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <img th:if="${promotion.product.imageUrl != null and promotion.product.imageUrl != ''}" 
                                 th:src="${promotion.product.imageUrl}" 
                                 alt="Product" 
                                 class="me-2" 
                                 style="width: 40px; height: 40px; object-fit: cover;">
                            <span th:text="${promotion.product.title}">Product Title</span>
                        </div>
                    </td>
                    <td>
                        <span class="badge" 
                              th:classappend="${promotion.type.name() == 'PERCENTAGE'} ? 'bg-info' : 'bg-warning'"
                              th:text="${promotion.type.name() == 'PERCENTAGE'} ? #{promotion.percentage} : #{promotion.amount}">
                            Phần trăm
                        </span>
                    </td>
                    <td>
                        <span th:if="${promotion.type.name() == 'PERCENTAGE'}" 
                              th:text="${promotion.discountValue} + '%'">20%</span>
                        <span th:unless="${promotion.type.name() == 'PERCENTAGE'}" 
                              th:text="${#numbers.formatInteger(promotion.discountValue,3,'POINT')} + ' VNĐ'">500,000 VNĐ</span>
                    </td>
                    <td th:text="${#numbers.formatInteger(promotion.product.price,3,'POINT')}">4,200,000</td>
                    <td class="text-danger fw-bold" 
                        th:text="${#numbers.formatInteger(promotion.calculateDiscountedPrice(promotion.product.price),3,'POINT')}">3,360,000</td>
                    <td>
                        <div class="small">
                            <div th:text="${#temporals.format(promotion.startDate, 'dd/MM/yyyy')}">01/01/2024</div>
                            <div th:text="#{promotion.to} + ' ' + ${#temporals.format(promotion.endDate, 'dd/MM/yyyy')}">to 31/01/2024</div>
                        </div>
                    </td>
                    <td>
                        <span class="badge" 
                              th:classappend="${promotion.isActive()} ? 'bg-success' : 'bg-secondary'"
                              th:text="${promotion.isActive()} ? #{promotion.active} : #{promotion.inactive}">
                            Đang hoạt động
                        </span>
                    </td>
                    <td>
                        <form th:if="${promotion.isActive()}" 
                              th:action="@{/promotions/{id}/deactivate(id=${promotion.id})}" 
                              method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger" 
                                    th:onclick="'return confirm(\'' + #{promotion.deactivateConfirm} + '\')'">
                                <span th:text="#{promotion.deactivateBtn}">Deactivate</span>
                            </button>
                        </form>
                        <span th:unless="${promotion.isActive()}" class="text-muted">-</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</section>
</body>
</html>
